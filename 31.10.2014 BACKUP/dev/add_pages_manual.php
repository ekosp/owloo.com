<?php
require_once('../owloo_config.php');
$pages = array();
$pages[] = 'https://www.facebook.com/PepsiPanama';
$pages[] = 'https://www.facebook.com/VolkswagenPA';
$pages[] = 'https://www.facebook.com/digicelpanamafans';
$pages[] = 'https://www.facebook.com/ClaroPanamaPaginaOficial';
$pages[] = 'https://www.facebook.com/movistarpanama';
$pages[] = 'https://www.facebook.com/BacCredomaticPanama';
$pages[] = 'https://www.facebook.com/acttwoespanol';
$pages[] = 'https://www.facebook.com/minipanama';
$pages[] = 'https://www.facebook.com/worldtimestore';
$pages[] = 'https://www.facebook.com/elClubOlimpia';
$pages[] = 'https://www.facebook.com/yingoparaguay';
$pages[] = 'http://www.facebook.com/59089862765';
$pages[] = 'http://www.facebook.com/90194069641';
$pages[] = 'http://www.facebook.com/133043186711972';
$pages[] = 'http://www.facebook.com/123009971075781';
$pages[] = 'http://www.facebook.com/247169439803';
$pages[] = 'http://www.facebook.com/409348517645';
$pages[] = 'http://www.facebook.com/134996166565930';
$pages[] = 'http://www.facebook.com/124553437626427';
$pages[] = 'http://www.facebook.com/264194356957974';
$pages[] = 'http://www.facebook.com/169021764231';
$pages[] = 'http://www.facebook.com/168757289506';
$pages[] = 'http://www.facebook.com/191913080830093';
$pages[] = 'http://www.facebook.com/176590149033283';
$pages[] = 'http://www.facebook.com/155545864531227';
$pages[] = 'http://www.facebook.com/28963119862';
$pages[] = 'http://www.facebook.com/124389767577672';
$pages[] = 'http://www.facebook.com/175984854514';
$pages[] = 'http://www.facebook.com/169021764231';
$pages[] = 'http://www.facebook.com/176590149033283';
$pages[] = 'http://www.facebook.com/200952609941045';
$pages[] = 'http://www.facebook.com/28963119862';
$pages[] = 'http://www.facebook.com/118325338212566';
$pages[] = 'http://www.facebook.com/156057357762712';
$pages[] = 'http://www.facebook.com/137657892926963';
$pages[] = 'http://www.facebook.com/167965119890296';
$pages[] = 'http://www.facebook.com/122760603905';
$pages[] = 'http://www.facebook.com/64119044379';
$pages[] = 'http://www.facebook.com/188053664550109';
$pages[] = 'http://www.facebook.com/138664326165739';
$pages[] = 'http://www.facebook.com/171768044491';
$pages[] = 'http://www.facebook.com/127735990588679';
$pages[] = 'http://www.facebook.com/200952609941045';
$pages[] = 'http://www.facebook.com/300882842026';
$pages[] = 'http://www.facebook.com/382085809472';
$pages[] = 'http://www.facebook.com/379915922194';
$pages[] = 'http://www.facebook.com/120233066038';
$pages[] = 'http://www.facebook.com/142919275994';
$pages[] = 'http://www.facebook.com/190300564339766';
$pages[] = 'http://www.facebook.com/107143776010250';
$pages[] = 'http://www.facebook.com/268918126983';
$pages[] = 'http://www.facebook.com/130077219041';
$pages[] = 'http://www.facebook.com/362430908370';
$pages[] = 'http://www.facebook.com/66278797016';
$pages[] = 'http://www.facebook.com/120180884406';
$pages[] = 'http://www.facebook.com/113144262054871';
$pages[] = 'http://www.facebook.com/119626204728343';
$pages[] = 'http://www.facebook.com/198139706022';
$pages[] = 'http://www.facebook.com/190300564339766';
$pages[] = 'https://www.facebook.com/HabanerasMx';
$pages[] = 'https://www.facebook.com/philadelphiamx';
$pages[] = 'https://www.facebook.com/ClubHuggies';
$pages[] = 'https://www.facebook.com/vivanuncios';
$pages[] = 'https://www.facebook.com/hersheyspostres';
$pages[] = 'https://www.facebook.com/KleenBebeMx';
$pages[] = 'https://www.facebook.com/dosequismexico';
$pages[] = 'https://www.facebook.com/OikosMexico';
$pages[] = 'https://www.facebook.com/Placerdesentir';
$pages[] = 'https://www.facebook.com/DoveMexico';
$pages[] = 'https://www.facebook.com/KotexMexico';
$pages[] = 'https://www.facebook.com/KleenexMexico';
$pages[] = 'https://www.facebook.com/Fud';
$pages[] = 'https://www.facebook.com/Coronamexico';
$pages[] = 'https://www.facebook.com/Corona';
$pages[] = 'https://www.facebook.com/Nescafe.MX';
$pages[] = 'https://www.facebook.com/redbull';
$pages[] = 'https://www.facebook.com/Levis';
$pages[] = 'https://www.facebook.com/CervezaModeloEspecial';
$pages[] = 'https://www.facebook.com/xbox';
$pages[] = 'https://www.facebook.com/aeropostale';
$pages[] = 'https://www.facebook.com/moda.suburbia';
$pages[] = 'https://www.facebook.com/FerreroRocher';
$pages[] = 'https://www.facebook.com/Pringles';
$pages[] = 'https://www.facebook.com/Telcel';
$pages[] = 'https://www.facebook.com/Zara';
$pages[] = 'https://www.facebook.com/KLIMCol';
$pages[] = 'https://www.facebook.com/JuanValdezCafe';
$pages[] = 'https://www.facebook.com/totto.brand';
$pages[] = 'https://www.facebook.com/CaracolTV';
$pages[] = 'https://www.facebook.com/GolCaracol';
$pages[] = 'https://www.facebook.com/CartoonNetwork';
$pages[] = 'https://www.facebook.com/TNTLA';
$pages[] = 'https://www.facebook.com/nickelodeon';
$pages[] = 'https://www.facebook.com/eltiempo';
$pages[] = 'http://www.facebook.com/191189080915084';
$pages[] = 'http://www.facebook.com/149440611739475';
$pages[] = 'http://www.facebook.com/106827416017627';
$pages[] = 'http://www.facebook.com/97041406678';
$pages[] = 'http://www.facebook.com/14302129065';
$pages[] = 'http://www.facebook.com/135155299865681';
$pages[] = 'http://www.facebook.com/120138132343';
$pages[] = 'http://www.facebook.com/133661209997478';
$pages[] = 'http://www.facebook.com/113515275375025';
$pages[] = 'http://www.facebook.com/187175894664803';
$pages[] = 'http://www.facebook.com/179196972095957';
$pages[] = 'http://www.facebook.com/126987724007337';
$pages[] = 'http://www.facebook.com/128318187217471';
$pages[] = 'http://www.facebook.com/40705356712';
$pages[] = 'http://www.facebook.com/169600629747627';
$pages[] = 'http://www.facebook.com/55164645762';
$pages[] = 'http://www.facebook.com/137633439645541';
$pages[] = 'http://www.facebook.com/278901102122445';
$pages[] = 'http://www.facebook.com/128647720484973';
$pages[] = 'http://www.facebook.com/105389699558866';
$pages[] = 'http://www.facebook.com/33331950906';
$pages[] = 'http://www.facebook.com/119282808161119';
$pages[] = 'http://www.facebook.com/121215061257945';
$pages[] = 'http://www.facebook.com/130724060297957';
$pages[] = 'http://www.facebook.com/118001464881366';
$pages[] = 'http://www.facebook.com/19034719952';
$pages[] = 'http://www.facebook.com/197394889304';
$pages[] = 'http://www.facebook.com/301776793182224';
$pages[] = 'http://www.facebook.com/71263708835';
$pages[] = 'http://www.facebook.com/96317175700';
$pages[] = 'http://www.facebook.com/19421792150';
$pages[] = 'http://www.facebook.com/138143586239557';
$pages[] = 'http://www.facebook.com/358063599252';
$pages[] = 'http://www.facebook.com/301776793182224';
$pages[] = 'http://www.facebook.com/175008385878292';
$pages[] = 'http://www.facebook.com/54097454162';
$pages[] = 'http://www.facebook.com/12666338365';
$pages[] = 'http://www.facebook.com/195559004643';
$pages[] = 'http://www.facebook.com/175067819212798';
$pages[] = 'http://www.facebook.com/130617083633514';
$pages[] = 'http://www.facebook.com/196372153719466';
$pages[] = 'http://www.facebook.com/169648419756909';
$pages[] = 'http://www.facebook.com/184501178986';
$pages[] = 'http://www.facebook.com/39685496568';
$pages[] = 'http://www.facebook.com/83850931685';
$pages[] = 'http://www.facebook.com/132920753391973';
$pages[] = 'http://www.facebook.com/173865892650552';
$pages[] = 'http://www.facebook.com/200586404047';
$pages[] = 'http://www.facebook.com/148092568537709';
$pages[] = 'http://www.facebook.com/123999107649123';
$pages[] = 'http://www.facebook.com/198079347055';
$pages[] = 'http://www.facebook.com/120417341376379';
$pages[] = 'http://www.facebook.com/9109104772';
$pages[] = 'http://www.facebook.com/145626958792497';
$pages[] = 'http://www.facebook.com/157658900912084';
$pages[] = 'http://www.facebook.com/148094215229134';
$pages[] = 'http://www.facebook.com/212721822127929';
$pages[] = 'http://www.facebook.com/215786641826924';
$pages[] = 'http://www.facebook.com/127283261403';
$pages[] = 'https://www.facebook.com/HuaweiDevicePanama';

$__cont = 1;
foreach($pages as $__page){
    if(!empty($__page)){
        $fb_page_id = get_fb_page_id_from_url($__page);
        if(!empty($fb_page_id)){
            $datos = file_get_contents('https://graph.facebook.com/'.$fb_page_id.'?fields=id,username,name,about,description,link,picture,cover,location,is_verified,likes,talking_about_count,category&locale=es_LA');
            $datos = json_decode ($datos, true);
            
            //print_r($datos);
            
            if(isset($datos['id']) && isset($datos['name'])){
                /*
                echo '<br/><br/>';
                echo 'id: '.$datos['id'].'<br/>';
                echo 'username: '.$datos['username'].'<br/>';
                echo 'name: '.$datos['name'].'<br/>';
                echo 'about: '.$datos['about'].'<br/>';
                echo 'description: '.$datos['description'].'<br/>';
                echo 'link: '.$datos['link'].'<br/>';
                echo 'picture: '.$datos['picture']['data']['url'].'<br/>';
                echo 'cover: '.$datos['cover']['source'].'<br/>';
                echo 'location: '.$datos['location']['country'].'<br/>';
                echo 'is_verified: '.$datos['is_verified'].'<br/>';
                echo 'likes: '.$datos['likes'].'<br/>';
                echo 'talking_about_count: '.$datos['talking_about_count'].'<br/>';
                echo 'category: '.$datos['category'].'<br/>';
                */
                
                $datos['username'] = (!empty($datos['username'])?$datos['username']:$datos['id']);
                
                $_fb_username = $datos['username'];
                
                if(!is_exist_fb_page($datos['id'])){
                
                    $id_page = add_fb_page($datos['id'], $datos['username'], $datos['name'], $datos['about'], $datos['description'], $datos['link'], $datos['picture']['data']['url'], $datos['cover']['source'], $datos['location']['country'], $datos['is_verified'], $datos['likes'], $datos['talking_about_count'], $datos['category']);
                    
                    if(!empty($id_page)){
                        
                        echo $__cont++.'<br/>';
                        
                        /***** Add likes and talking_about *****/
                        if(!is_exist_today_fb_page_likes_talking_about($id_page)){
                            add_fb_page_likes_talking_about($id_page, $datos['likes'], $datos['talking_about_count']);
                        }
                        /***** END - Add likes and talking_about *****/
                        
                        $access_token = get_fb_page_access_token();
                        $until = date('U');
                        $since = $until - (90 * 24 * 60 * 60);
                        $local_fans_country = file_get_contents('https://graph.facebook.com/'.$datos['id'].'/insights/page_fans_country?since='.$since.'&until='.$until.'&locale=es_LA&access_token='.$access_token);
                        $local_fans_country = json_decode ($local_fans_country, true);
                        
                        //print_r($local_fans_country); die();
                        
                        if(isset($local_fans_country['data']) && $local_fans_country['data'][0]['name'] == 'page_fans_country'){
                            $sql_insert = '';
                            $aux_first = true;
                            foreach ($local_fans_country['data'][0]['values'] as $local_fan) {
                                $date = explode('T', $local_fan['end_time']);
                                foreach ($local_fan['value'] as $key => $value) {
                                    $_country_id = get_country_id_from_code($key);
                                    if(!empty($_country_id)){
                                        if(!$aux_first) $sql_insert .= ','; else $aux_first = false;
                                        $sql_insert .= "(NULL, ".mysql_real_escape_string($id_page).",".mysql_real_escape_string($_country_id).",".mysql_real_escape_string($value).",'".mysql_real_escape_string($date[0])."')";
                                    }
                                }
                            }
                            
                            if(!empty($sql_insert))
                                add_lote_fb_page_local_fan($sql_insert);
                        }
                        
                        update_fb_page_likes_talking_about_local_fans($id_page, $datos['likes'], $datos['talking_about_count'], get_first_country_local_fans($id_page));
                        
                    }
                    else {
                        $mensaje_new_fan_page = '<div>Lo sentimos, <strong>no hemos podido procesar su petición</strong>.</div>
                                                 <div>Favor, intentelo más tarde...</div>';
                    }
                }
            }
            else {
                $mensaje_new_fan_page = "<div>Puede que <strong>".$__page."</strong> no esté registrado en Facebook.</div>
                               <div>Favor verifique la página ingresada y vuelve a intentarlo!</div>";
            }
        }
        else {
            $mensaje_new_fan_page = "<div>Puede que <strong>".$__page."</strong> no esté registrado en Facebook.</div>
                               <div>Favor verifique la página ingresada y vuelve a intentarlo!</div>";
        }
        
        echo '<br>'.$mensaje_new_fan_page.'<br>';
        
    }
}